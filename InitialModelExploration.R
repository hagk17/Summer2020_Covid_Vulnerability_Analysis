library(tidyverse)
library(magrittr)
library(xlsx)
library(esquisse)

`%notin%` <- Negate(`%in%`)

census_data <- read.xlsx("Data/clean_0909_data.xlsx", sheetIndex = 6)
census_data %<>% select(-NA.)

mini_data <- census_data %>% select(Total_Cases, n_pop, Pop_Density, n_minority)
log_data <- mini_data %>% 
  mutate(log_cases = log(Total_Cases), 
         log_pop = log(n_pop),
         log_density = log(Pop_Density),
         log_minority = log(n_minority)) %>%
  filter(log_cases != -Inf)

## model for log cases and population 
log_cp_mod <- lm(log_cases ~ log_pop+(-1), data = log_data)
summary(log_cp_mod) #R2 = 0.9071

## model for log cases and density 
log_cd_mod  <- lm(log_cases ~ log_density+(-1), data = log_data)
summary(log_cd_mod) #R2 = 0.9518 #intercept = 0 slope = 0.707010


ggplot(log_data) +
 aes(x = log_density, y = log_cases) +
 geom_point(size = 1L, colour = "#47039f") +
 geom_abline(intercept = 0, slope = 0.707010)
 labs(x = "Log of Population Density ", y = "Log of Total Cases ") +
 theme_minimal()
#possibly need to remove the 2.5 cases 


## model for log cases and minority 
log_cm_mod <- lm(log_cases ~ log_minority, data = log_data)
summary(log_cm_mod) #R2 = 0.7794

## model for proportion of cases and minority 

mini_p_data <- census_data %>% select(p_cases, p_minority, Town) %>%
  filter(Town != 'Chelsea')

p_cm_mod <- lm(p_cases ~ p_minority, data = mini_p_data)
summary(p_cm_mod ) #R2 = 0.4917
plot(p_cm_mod )

ggplot(mini_p_data) +
  aes(x = p_minority, y = p_cases) +
  geom_point(size = 1L, colour = "#47039f") +
  geom_abline(intercept = 0.0028952, slope = 0.0435409)
labs(x = "Proportion Minory ", y = "Proportion of Total Cases") +
  theme_minimal()


